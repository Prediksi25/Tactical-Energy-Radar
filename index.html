<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>VSGPS – Simulasi Deteksi Minyak</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />  <!-- Leaflet -->  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>  <!-- Heatmap -->  <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
    }
    h1 {
      text-align: center;
      padding: 12px;
      color: #38bdf8;
    }
    #map {
      height: 320px;
      margin: 10px;
      border-radius: 14px;
    }
    .panel {
      background: #020617;
      margin: 10px;
      padding: 14px;
      border-radius: 14px;
      box-shadow: 0 8px 20px rgba(0,0,0,.4);
    }
    button {
      width: 100%;
      padding: 14px;
      border-radius: 12px;
      border: none;
      background: #38bdf8;
      color: #020617;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover { background: #0ea5e9; }
    .info { margin-top: 8px; }

    /* WATERMARK */
    .watermark {
      position: fixed;
      bottom: 10px;
      right: 10px;
      font-weight: bold;
      color: rgba(255,255,255,0.35);
      pointer-events: none;
      letter-spacing: 1px;
      z-index: 9999;
    }
  </style></head>
<body><h1>VSGPS – Simulasi Deteksi Minyak</h1><div id="map"></div><div class="panel">
  <button onclick="startScan()">Mulai Scan</button>
  <div class="info" id="info">Menunggu GPS...</div>
  <div class="info" id="reserve">Cadangan: -</div>
</div><div class="watermark">VSGPS</div><script>
  // Init map
  const map = L.map('map').setView([-2.9, 104.7], 13);

  const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 });
  const sat = L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
    subdomains: ['mt0','mt1','mt2','mt3'], maxZoom: 19
  });

  osm.addTo(map);
  L.control.layers({ 'Peta Standar': osm, 'Peta Satelit': sat }).addTo(map);

  let gpsMarker, basinCircle, heatLayer, radarCircle, radarInterval;
  let oilMarkers = [];

  function rand(min, max) {
    return Math.random() * (max - min) + min;
  }

  function playBeep(freq = 800, duration = 120) {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.type = 'sine';
    osc.frequency.value = freq;
    gain.gain.value = 0.05;
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.start();
    setTimeout(() => { osc.stop(); ctx.close(); }, duration);
  }

  function startScan() {
    if (!navigator.geolocation) {
      alert('GPS tidak didukung');
      return;
    }

    navigator.geolocation.getCurrentPosition(pos => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;

      map.setView([lat, lon], 15);

      if (gpsMarker) map.removeLayer(gpsMarker);
      if (basinCircle) map.removeLayer(basinCircle);
      if (heatLayer) map.removeLayer(heatLayer);
      oilMarkers.forEach(m => map.removeLayer(m));
      oilMarkers = [];

            gpsMarker = L.marker([lat, lon]).addTo(map).bindPopup('Posisi GPS User').openPopup();

            // Radar animasi
      if (radarCircle) map.removeLayer(radarCircle);
      if (radarInterval) clearInterval(radarInterval);

      radarCircle = L.circle([lat, lon], {
        radius: 200,
        color: '#38bdf8',
        fillOpacity: 0.05
      }).addTo(map);

      let radarRadius = 200;
      let step = 0;
      radarInterval = setInterval(() => {
        step++;
        radarRadius += 150;
        radarCircle.setRadius(radarRadius);
        playBeep(600 + step * 80, 100);
        if (radarRadius >= 1000) {
          clearInterval(radarInterval);
          map.removeLayer(radarCircle);
        }
      }, 220);

      // Radius cekungan 1 KM
      basinCircle = L.circle([lat, lon], {
        radius: 1000,
        color: '#facc15',
        fillOpacity: 0.15
      }).addTo(map);

      const oilCount = Math.floor(rand(5, 11)); // 5–10 titik
      const heatData = [];

      for (let i = 0; i < oilCount; i++) {
        const oLat = lat + rand(-0.009, 0.009);
        const oLon = lon + rand(-0.009, 0.009);
        const depth = Math.floor(rand(360, 540));

        const marker = L.circleMarker([oLat, oLon], {
          radius: 7,
          color: 'red',
          fillOpacity: 0.8
        }).addTo(map).bindPopup(`Minyak Dummy<br>Kedalaman: ${depth} m`);

        oilMarkers.push(marker);
        heatData.push([oLat, oLon, 0.8]);
      }

      heatLayer = L.heatLayer(heatData, { radius: 25, blur: 18 }).addTo(map);

      const reserve = oilCount * Math.floor(rand(40, 80));
      document.getElementById('info').innerText = `Titik minyak terdeteksi: ${oilCount}`;
      document.getElementById('reserve').innerText = `Estimasi cadangan: ${reserve} juta barel (dummy)`;

    }, () => alert('Izin GPS ditolak'));
  }
</script></body>
</html>