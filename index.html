<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Energy Radar ‚Äì Satellite Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">  <!-- Leaflet CSS -->  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
      font-family: system-ui, Arial, sans-serif;
    }

    #map {
      width: 100%;
      height: 100%;
      background: #000;
    }

    .top-badge {
      position: fixed;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.7);
      color: #22d3ee;
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 12px;
      z-index: 1000;
      letter-spacing: .5px;
    }

    .radar {
      position: absolute;
      width: 260px;
      height: 260px;
      border-radius: 50%;
      background: conic-gradient(from 0deg, rgba(34,211,238,.45), rgba(34,211,238,0) 65%);
      animation: spin 4s linear infinite;
      pointer-events: none;
      z-index: 600;
      mix-blend-mode: screen;
    }

    .pulse {
      position: absolute;
      width: 260px;
      height: 260px;
      border-radius: 50%;
      border: 2px solid rgba(34,211,238,.6);
      animation: pulse 2.5s ease-out infinite;
      pointer-events: none;
      z-index: 599;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to   { transform: rotate(360deg); }
    }

    @keyframes pulse {
      from { transform: scale(.6); opacity: .8; }
      to   { transform: scale(1.2); opacity: 0; }
    }

    .offline-grid {
      background:
        linear-gradient(#020617 1px, transparent 1px),
        linear-gradient(90deg, #020617 1px, transparent 1px);
      background-size: 40px 40px;
      background-color: #020617;
    }
  </style></head>
<body><div id="map"></div>
<div class="top-badge">‚óâ ENERGY RADAR ‚Äì SATELLITE MODE</div><div id="panel" style="position:fixed;bottom:14px;left:50%;transform:translateX(-50%);width:calc(100% - 28px);max-width:420px;background:rgba(0,0,0,.75);backdrop-filter:blur(8px);border-radius:16px;padding:12px;z-index:1000;color:#e5e7eb;font-size:14px;">
  <div id="status">Status: scanning‚Ä¶</div>
  <input id="pointName" placeholder="Nama titik" style="width:100%;margin-top:6px;padding:10px;border-radius:12px;border:none;background:#020617;color:#fff" />
  <button id="savePoint" disabled style="width:100%;margin-top:8px;padding:12px;border-radius:14px;border:none;background:#dc2626;color:#fff;font-weight:600">Simpan Titik</button>
</div><!-- Leaflet JS --><script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script><script>
  // ============================
  // MAP INIT (SATELLITE ONLY)
  // ============================
  const map = L.map('map', {
    zoomControl: false,
    attributionControl: false
  }).setView([-6.2, 106.8], 16);

  const satellite = L.tileLayer(
    'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
    { maxZoom: 19 }
  );

  satellite.addTo(map);

  // ============================
  // OFFLINE FALLBACK (NO BLACK)
  // ============================
  function handleConnection() {
    if (!navigator.onLine) {
      map.getContainer().classList.add('offline-grid');
      if (map.hasLayer(satellite)) map.removeLayer(satellite);
    } else {
      map.getContainer().classList.remove('offline-grid');
      if (!map.hasLayer(satellite)) satellite.addTo(map);
    }
  }

  window.addEventListener('online', handleConnection);
  window.addEventListener('offline', handleConnection);
  handleConnection();

  // ============================
  // GPS + RADAR OVERLAY
  // ============================
  let radarEl, pulseEl, gpsMarker;

  function initRadar() {
    radarEl = document.createElement('div');
    radarEl.className = 'radar';

    pulseEl = document.createElement('div');
    pulseEl.className = 'pulse';

    map.getContainer().appendChild(pulseEl);
    map.getContainer().appendChild(radarEl);
  }

  function updateRadar(latlng) {
    const p = map.latLngToContainerPoint(latlng);
    const size = 260;
    const half = size / 2;

    radarEl.style.left = (p.x - half) + 'px';
    radarEl.style.top  = (p.y - half) + 'px';
    radarEl.style.transform = `rotate(${heading}deg)`;

    pulseEl.style.left = (p.x - half) + 'px';
    pulseEl.style.top  = (p.y - half) + 'px';
  }

  initRadar();

  // Compass (device orientation)
let heading = 0;
if (window.DeviceOrientationEvent) {
  window.addEventListener('deviceorientationabsolute', e => {
    if (e.alpha !== null) heading = e.alpha;
  });
}

navigator.geolocation.watchPosition(pos => {
    const latlng = [pos.coords.latitude, pos.coords.longitude];

    if (!gpsMarker) {
      gpsMarker = L.circleMarker(latlng, {
        radius: 6,
        color: '#22d3ee',
        fillColor: '#22d3ee',
        fillOpacity: 1
      }).addTo(map);
      map.setView(latlng, 17);
    } else {
      gpsMarker.setLatLng(latlng);
    }

    updateRadar(latlng);
  }, err => {
    alert('GPS tidak aktif');
  }, { enableHighAccuracy: true });

  map.on('move zoom', () => {
    if (gpsMarker) updateRadar(gpsMarker.getLatLng());
  });

// === Point saving + depth dummy ===
const btnSave = document.getElementById('savePoint');
const statusEl = document.getElementById('status');

btnSave.onclick = () => {
  if (!gpsMarker) return;
  const name = document.getElementById('pointName').value || 'Survey Point';
  const depth = Math.floor(Math.random()*201) + 400; // 400‚Äì600 m

  L.marker(gpsMarker.getLatLng()).addTo(map)
    .bindPopup(`üõ¢Ô∏è ${name}<br>Kedalaman: ${depth} m`).openPopup();

  statusEl.innerText = 'Status: titik tersimpan';
  btnSave.disabled = true;
};
  });
</script></body>
</html>