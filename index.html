<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Tactical Energy Radar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />  <!-- PWA -->  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#020617">  <!-- Leaflet -->  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />  <style>
    body { margin:0; font-family: system-ui, Arial; background:#020617; color:#e5e7eb; }
    #map { position:fixed; inset:0; }

    /* Branding badge */
    .badge {
      position:fixed; top:12px; left:50%; transform:translateX(-50%);
      background:rgba(2,6,23,.85);
      padding:6px 14px; border-radius:999px;
      font-size:12px; letter-spacing:.6px;
      box-shadow:0 0 12px rgba(34,211,238,.4);
    }

    /* Bottom panel */
    .panel {
      position:fixed; bottom:12px; left:50%; transform:translateX(-50%);
      width:calc(100% - 24px); max-width:420px;
      background:rgba(15,23,42,.95);
      backdrop-filter:blur(10px);
      border-radius:18px; padding:12px;
      box-shadow:0 20px 40px rgba(0,0,0,.5);
    }

    .status { font-size:14px; margin-bottom:8px; }

    input, button {
      width:100%; padding:12px; border:none; border-radius:14px;
      font-size:15px; margin-top:6px;
    }
    input { background:#020617; color:#fff; }
    button { background:#dc2626; color:#fff; font-weight:600; }
    button:disabled { background:#334155; }

    /* Radar sweep overlay */
    .radar-sweep {
      position:absolute;
      width:280px;
      height:280px;
      border-radius:50%;
      background:conic-gradient(from 0deg, rgba(34,211,238,.45), rgba(34,211,238,0) 65%);
      animation:sweep 3.5s linear infinite;
      pointer-events:none;
      mix-blend-mode:screen;
      z-index:500;
    }

    @keyframes sweep { from {transform:rotate(0deg);} to {transform:rotate(360deg);} }
  </style></head>
<body><div id="map"></div>
<div class="badge">‚óâ Tactical Energy Radar</div><div class="panel">
  <div class="status" id="status">Status: scanning area</div>
  <input id="namaTitik" placeholder="Nama titik survey" />
  <button id="btnValidasi" onclick="validasiTitik()" disabled>Tandai Titik</button>
</div><audio id="beep">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
</audio><script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script><script>
  // Register service worker (offline demo)
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js');
  }

  const map = L.map('map', { zoomControl:false }).setView([-6.2,106.8], 16);
  // Satellite map (Esri World Imagery)
  const satelliteLayer = L.tileLayer(
    'https://server.arcgisonline.com/ArcGIS/rest/services/' +
    'World_Imagery/MapServer/tile/{z}/{y}/{x}',
    { maxZoom: 19, attribution: '¬© Esri World Imagery' }
  ).addTo(map);

  // Online / Offline handling
  function cekOnline() {
    if (!navigator.onLine) {
      map.getContainer().classList.add('offline-map');
      if (map.hasLayer(satelliteLayer)) map.removeLayer(satelliteLayer);
      statusEl.innerText = 'Status: OFFLINE DEMO MODE';
    } else {
      map.getContainer().classList.remove('offline-map');
      if (!map.hasLayer(satelliteLayer)) satelliteLayer.addTo(map);
    }
  }
  window.addEventListener('online', cekOnline);
  window.addEventListener('offline', cekOnline);
  cekOnline();

  const radiusRadar = 60;
  const radiusValidasi = 15;
  const statusEl = document.getElementById('status');
  const btn = document.getElementById('btnValidasi');
  const beep = document.getElementById('beep');

  let userMarker, radarCircle, deteksi;

  // REAL river layer (GeoJSON from OpenStreetMap ‚Äì demo static)
  const riverLayer = L.geoJSON({
    "type":"FeatureCollection",
    "features":[{
      "type":"Feature",
      "geometry":{
        "type":"LineString",
        "coordinates":[
          [106.795,-6.200],[106.800,-6.205],[106.805,-6.210]
        ]
      }
    }]
  },{ style:{ color:'#22d3ee', weight:3, opacity:0.9 }}).addTo(map);


  navigator.geolocation.watchPosition(pos => {
    const latlng = [pos.coords.latitude, pos.coords.longitude];

    if (!userMarker) {
      userMarker = L.marker(latlng).addTo(map);
      radarCircle = L.circle(latlng, {
        radius: radiusRadar,
        color:'#22d3ee', weight:2,
        fillColor:'#22d3ee', fillOpacity:.12
      }).addTo(map);

      // Radar sweep overlay
      const sweep = document.createElement('div');
      sweep.className = 'radar-sweep';
      map.getContainer().appendChild(sweep);

      const pulse = document.createElement('div');
      pulse.className = 'radar-pulse';
      map.get
        sweep.style.left = (p.x - 150) + 'px';
        sweep.style.top  = (p.y - 150) + 'px';
      });
    } else {
      userMarker.setLatLng(latlng);
      radarCircle.setLatLng(latlng);
    }

    cekDeteksi(latlng);
  }, () => alert('GPS tidak aktif'));

  function cekDeteksi(latlng) {
    sungai.getLatLngs().forEach(p => {
      if (!deteksi && map.distance(latlng,p) < radiusRadar) {
        deteksi = L.circleMarker(p, {
          radius:9, color:'red', fillOpacity:.85
        }).addTo(map);
        statusEl.innerText = 'Status: oil flow detected';
        btn.disabled = false;
        beep.play();
      }
    });
  }

  function validasiTitik() {
    const jarak = map.distance(userMarker.getLatLng(), deteksi.getLatLng());
    if (jarak > radiusValidasi) {
      alert('Dekati titik merah ('+jarak.toFixed(1)+' m)');
      return;
    }

    const nama = namaTitik.value || 'Oil Point';
    const depth = Math.floor(Math.random()*201) + 400;

    map.removeLayer(deteksi);
    L.marker(userMarker.getLatLng()).addTo(map)
      .bindPopup(`üõ¢Ô∏è ${nama}<br>Kedalaman: ${depth} m`);

    deteksi = null;
    btn.disabled = true;
    statusEl.innerText = 'Status: point saved';
  }
</script></body>
</html>